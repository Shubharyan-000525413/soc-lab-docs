<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Malware Analysis Lab Report</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap');
    
    body { margin: 0; padding: 0; background: #0f111a; color: #a0aabf; font-family: 'Inter', sans-serif; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    
    .container {
        max-width: 210mm;
        margin: 0 auto;
        padding: 40px;
        background: #0f111a;
        min-height: 100vh;
        border-top: 5px solid #00d4ff;
    }

    h1, h2, h3, h4 { color: #ffffff; text-transform: uppercase; letter-spacing: 0.5px; }
    h1 { font-size: 26px; border-bottom: 2px solid #2d3648; padding-bottom: 15px; margin-bottom: 30px; }
    h2 { color: #00d4ff; font-size: 18px; margin-top: 35px; border-left: 4px solid #00d4ff; padding-left: 12px; }
    h3 { font-size: 14px; color: #e2e8f0; margin-top: 25px; font-weight: 700; }
    h4 { font-size: 13px; margin-top: 18px; }

    .meta-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-bottom: 30px;
        background: #1a1f2e;
        padding: 20px;
        border-radius: 4px;
        border: 1px solid #2d3648;
    }
    .meta-item strong { color: #64748b; font-size: 10px; display: block; text-transform: uppercase; margin-bottom: 5px; }
    .meta-item span { color: #fff; font-weight: 600; font-size: 14px; }
    .severity-high { color: #ff4d4d !important; text-shadow: 0 0 5px rgba(255, 77, 77, 0.4); }

    .code-block {
        background-color: #0d0d0d;
        border: 1px solid #333;
        border-left: 4px solid #f58220;
        color: #22c55e;
        font-family: 'JetBrains Mono', monospace;
        padding: 15px;
        margin: 10px 0 20px 0;
        border-radius: 4px;
        font-size: 12px;
        white-space: pre-wrap;
    }

    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
    th { background: #2d3648; color: #fff; padding: 10px; text-align: left; border: 1px solid #3f4c6b; }
    td { background: #151921; border: 1px solid #2d3648; padding: 10px; color: #cbd5e1; vertical-align: top; }

    ul { padding-left: 20px; margin-bottom: 15px; }
    li { margin-bottom: 5px; font-size: 13px; line-height: 1.5; }

    .remediation-box { border: 1px solid #3f4c6b; padding: 15px; background: #1a1f2e; margin-bottom: 10px; }
    .remediation-header { color: #00d4ff; font-weight: bold; margin-bottom: 10px; display: block; }

    .tag-pill {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 999px;
        background: #1f2937;
        border: 1px solid #374151;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: .06em;
        color: #9ca3af;
        margin-right: 4px;
        margin-bottom: 4px;
    }

    @media print {
        body { margin: 0; }
        .container { width: 100%; max-width: none; margin: 0; }
        .page-break { page-break-before: always; }
    }
</style>
</head>
<body>
<div class="container">
    <div style="text-align:right;font-size:10px;color:#64748b;margin-bottom:10px;">// CONFIDENTIAL</div>

    <h1>Malware Analysis Lab Report<br>
        <span style="font-size:16px;color:#64748b;text-transform:none;">Static & Dynamic Analysis of HopHelper.exe</span>
    </h1>

    <div style="background:#2d3648;color:white;padding:15px;font-style:italic;border-left:4px solid #ff4d4d;margin-bottom:30px;font-size:13px;">
        This report documents a full static and dynamic analysis of <strong>HopHelper.exe</strong> in a sandbox environment, following real-world SOC malware triage and documentation standards.
    </div>

    <div class="meta-grid">
        <div class="meta-item"><strong>Case ID</strong><span>AOC-2025-MAL-IR-001</span></div>
        <div class="meta-item"><strong>Analyst</strong><span>[Shubharyan Asthana]</span></div>
        <div class="meta-item"><strong>Sample Name</strong><span>HopHelper.exe</span></div>
        <div class="meta-item"><strong>SHA256</strong><span>F29C270068F865EF4A747E2683BFA07667BF64E768B38FBB9A2750A3D879CA33</span></div>
        <div class="meta-item"><strong>Environment</strong><span>Isolated Windows Sandbox (TryHackMe AoC 2025)</span></div>
        <div class="meta-item"><strong>Severity</strong><span class="severity-high">HIGH (Malicious executable with persistence & C2)</span></div>
    </div>

    <h2>1. Lab Overview and Objectives</h2>

    <h3>1.1 Purpose</h3>
    <p>
        This investigation examines the suspicious executable <strong>HopHelper.exe</strong>, distributed via an email attachment at The Best Festival Company (TBFC). The goal is to determine:
    </p>
    <ul>
        <li>Whether the file is malicious or benign.</li>
        <li>How it behaves on an endpoint (registry, file system, network).</li>
        <li>What indicators of compromise (IOCs) it leaves behind.</li>
        <li>How defenders can detect and contain it in an enterprise environment.</li>
    </ul>

    <h3>1.2 Scope & Objectives</h3>
    <ul>
        <li>Perform <strong>static analysis</strong> of HopHelper.exe using PeStudio.</li>
        <li>Perform <strong>dynamic analysis</strong> using Regshot and Process Monitor (ProcMon).</li>
        <li>Identify persistence mechanisms and outbound communication.</li>
        <li>Extract IOCs (hashes, registry keys, protocol usage, flags).</li>
        <li>Map observed behaviour to <strong>MITRE ATT&amp;CK</strong> techniques.</li>
        <li>Provide actionable detection and hardening recommendations.</li>
    </ul>

    <h2>2. Methodology</h2>

    <h3>2.1 Sample Handling & Sandbox</h3>
    <ul>
        <li>Analysis conducted in an <strong>isolated Windows virtual machine</strong> provided by TryHackMe (sandbox environment).</li>
        <li>Sample location: <code>Desktop\HopHelper\HopHelper.exe</code></li>
        <li>Tools used:
            <span class="tag-pill">PeStudio</span>
            <span class="tag-pill">Regshot</span>
            <span class="tag-pill">Process Monitor (ProcMon)</span>
        </li>
        <li>No external internet browsing or production systems were involved.</li>
    </ul>

    <h3>2.2 Static Analysis Workflow (PeStudio)</h3>
    <ol>
        <li>Launch PeStudio from the analyst desktop shortcut.</li>
        <li>Open the sample <strong>HopHelper.exe</strong> via <em>File → Open</em> or drag-and-drop.</li>
        <li>Record the <strong>SHA256</strong> checksum under the file properties.</li>
        <li>Review the <strong>strings</strong> section to:
            <ul>
                <li>Identify readable text, potential C2 infrastructure, and embedded markers.</li>
                <li>Extract the embedded TryHackMe flag.</li>
            </ul>
        </li>
    </ol>

    <h3>2.3 Dynamic Analysis Workflow (Regshot + Execution)</h3>
    <ol>
        <li>Open <strong>Regshot</strong> and set output path to the desktop.</li>
        <li>Create <strong>First Shot</strong> (baseline registry snapshot) before execution.</li>
        <li>Execute <strong>HopHelper.exe</strong> from the <em>HopHelper</em> directory.</li>
        <li>After execution, return to Regshot and take the <strong>Second Shot</strong>.</li>
        <li>Run <strong>Compare</strong> to generate a registry difference report.</li>
        <li>Search for references to <code>HopHelper</code> within the diff output.</li>
    </ol>

    <h3>2.4 Dynamic Analysis Workflow (Process Monitor)</h3>
    <ol>
        <li>Launch <strong>Process Monitor (ProcMon)</strong>.</li>
        <li>Ensure capture is <strong>enabled</strong> (Play button depressed).</li>
        <li>Execute <strong>HopHelper.exe</strong> again while ProcMon is capturing.</li>
        <li>After 30–60 seconds, stop capture.</li>
        <li>Apply filters:
            <ul>
                <li>Filter by <strong>Process Name</strong> to isolate HopHelper-related events (if visible).</li>
                <li>Filter by <strong>Operation contains "TCP"</strong> to identify network activity.</li>
            </ul>
        </li>
        <li>Review network events and confirm protocol used.</li>
    </ol>

    <div class="page-break"></div>

    <h2>3. Static Analysis Findings</h2>

    <h3>3.1 File Identity</h3>
    <table>
        <thead>
            <tr><th>Property</th><th>Value</th></tr>
        </thead>
        <tbody>
            <tr><td>File Name</td><td>HopHelper.exe</td></tr>
            <tr><td>SHA256</td><td>F29C270068F865EF4A747E2683BFA07667BF64E768B38FBB9A2750A3D879CA33</td></tr>
            <tr><td>Environment</td><td>Windows (TryHackMe AoC sandbox)</td></tr>
            <tr><td>Classification</td><td>Suspicious / Malicious (based on persistence & C2 behaviour)</td></tr>
        </tbody>
    </table>

    <h3>3.2 Strings Analysis</h3>
    <p>
        Reviewing the strings in PeStudio revealed an embedded TryHackMe flag:
    </p>
    <div class="code-block">THM{STRINGS_FOUND}</div>
    <p>
        While the flag itself is lab-specific, the presence of readable markers, potential URLs, and structured text indicates that the binary is not a benign utility. In a real environment, strings such as:
    </p>
    <ul>
        <li>Domain names or IP addresses</li>
        <li>URL paths</li>
        <li>Command-line switches</li>
        <li>Credential-like values</li>
    </ul>
    <p>would be treated as potential indicators of C2 infrastructure or attacker tooling.</p>

    <h3>3.3 Static Indicators & Risk</h3>
    <ul>
        <li>Non-trusted executable delivered via unexpected email attachment (<strong>social engineering</strong> vector).</li>
        <li>Executable nature (.exe) rather than document or known business tool.</li>
        <li>Obvious need for deeper dynamic analysis to confirm behaviour.</li>
    </ul>

    <h2>4. Dynamic Analysis Findings</h2>

    <h3>4.1 Registry Persistence (Regshot)</h3>
    <p>
        Comparison of registry snapshots before and after execution revealed that <strong>HopHelper.exe</strong> writes a persistence entry under the current user’s Run key:
    </p>
    <div class="code-block">
HKU\S-1-5-21-1966530601-3185510712-10604624-1008\Software\Microsoft\Windows\CurrentVersion\Run\HopHelper
    </div>
    <p>
        This ensures the malware will be executed automatically at user logon, a classic persistence technique.
    </p>

    <h3>4.2 Network Behaviour (ProcMon)</h3>
    <p>
        Filtering Process Monitor for <strong>TCP</strong> operations associated with the sample shows communication using the <strong>HTTP</strong> protocol:
    </p>
    <table>
        <thead>
            <tr><th>Observation</th><th>Value</th></tr>
        </thead>
        <tbody>
            <tr><td>Protocol</td><td>HTTP</td></tr>
            <tr><td>Channel Type</td><td>Outbound TCP connections</td></tr>
            <tr><td>Purpose (Inferred)</td><td>Beaconing / C2 communication with remote panel</td></tr>
        </tbody>
    </table>
    <p>
        In a real environment, the destination IP/domain and URI paths would be captured as IOCs and blocked at network boundaries.
    </p>

    <h3>4.3 Behaviour Summary</h3>
    <ul>
        <li>Executes successfully in user context.</li>
        <li>Modifies <strong>Run</strong> registry key to achieve persistence.</li>
        <li>Establishes <strong>HTTP-based outbound communication</strong>, consistent with C2 or data exfiltration channels.</li>
        <li>Leaves identifiable artefacts (hash, registry key, strings) useful for detection.</li>
    </ul>

    <div class="page-break"></div>

    <h2>5. Indicators of Compromise (IOCs)</h2>

    <table>
        <thead>
            <tr><th>Type</th><th>Value</th><th>Notes</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>File Hash (SHA256)</td>
                <td>F29C270068F865EF4A747E2683BFA07667BF64E768B38FBB9A2750A3D879CA33</td>
                <td>Unique identifier for HopHelper.exe</td>
            </tr>
            <tr>
                <td>Registry Key</td>
                <td>HKU\S-1-5-21-1966530601-3185510712-10604624-1008\Software\Microsoft\Windows\CurrentVersion\Run\HopHelper</td>
                <td>Persistence: auto-run at logon</td>
            </tr>
            <tr>
                <td>Protocol</td>
                <td>HTTP (over TCP)</td>
                <td>Used for outbound communication</td>
            </tr>
            <tr>
                <td>Lab Flag</td>
                <td>THM{STRINGS_FOUND}</td>
                <td>Embedded marker confirming strings extraction success (training-specific)</td>
            </tr>
        </tbody>
    </table>

    <h2>6. MITRE ATT&amp;CK Mapping</h2>

    <table>
        <thead>
            <tr><th>Stage</th><th>Technique</th><th>ID</th><th>Evidence</th></tr>
        </thead>
        <tbody>
            <tr>
                <td>Initial Access</td>
                <td>User Execution – Malicious File</td>
                <td>T1204.002</td>
                <td>HopHelper.exe delivered via email attachment</td>
            </tr>
            <tr>
                <td>Execution</td>
                <td>Native OS Binary / Custom Tool</td>
                <td>T1059 (Generic)</td>
                <td>User executes HopHelper.exe on endpoint</td>
            </tr>
            <tr>
                <td>Persistence</td>
                <td>Registry Run Keys / Startup Folder</td>
                <td>T1060 / T1547.001</td>
                <td>Run key created under CurrentVersion\Run\HopHelper</td>
            </tr>
            <tr>
                <td>Command &amp; Control</td>
                <td>Application Layer Protocol – Web Protocols</td>
                <td>T1071.001</td>
                <td>Outbound HTTP traffic observed in ProcMon</td>
            </tr>
        </tbody>
    </table>

    <h2>7. Root Cause & Impact Assessment</h2>
    <p>
        <strong>Root Cause:</strong> A malicious executable was distributed via a spoofed internal email ("Elf McClause"), relying on user execution without adequate email filtering or endpoint controls.
    </p>
    <p>
        <strong>Impact (Lab Context):</strong>
    </p>
    <ul>
        <li>Establishment of persistent malware on the endpoint via registry modification.</li>
        <li>Potential C2 beaconing over HTTP to attacker-controlled infrastructure.</li>
        <li>Risk of follow-on actions (data theft, lateral movement, additional payloads) in a real environment.</li>
    </ul>

    <h2>8. Recommendations</h2>

    <div class="remediation-box">
        <span class="remediation-header">Immediate Actions</span>
        <ul>
            <li>Isolate affected hosts where HopHelper.exe was executed.</li>
            <li>Remove the persistence key:
                <div class="code-block">
HKU\&lt;User SID&gt;\Software\Microsoft\Windows\CurrentVersion\Run\HopHelper
                </div>
            </li>
            <li>Delete the HopHelper.exe binary and any related artefacts after forensic acquisition.</li>
        </ul>
    </div>

    <div class="remediation-box">
        <span class="remediation-header">Detection & Monitoring</span>
        <ul>
            <li>Create SIEM detection rules for:
                <ul>
                    <li>New values under <code>CurrentVersion\Run</code> referencing unknown binaries.</li>
                    <li>Execution of untrusted executables from user profile or temp paths.</li>
                    <li>Suspicious outbound HTTP traffic to non-corporate destinations.</li>
                </ul>
            </li>
            <li>Ingest endpoint telemetry (EDR, Sysmon) to monitor process creation and registry changes.</li>
        </ul>
    </div>

    <div class="remediation-box">
        <span class="remediation-header">Hardening & Prevention</span>
        <ul>
            <li>Implement robust email filtering and attachment sandboxing.</li>
            <li>Educate users on phishing and unexpected executables, especially outside business hours.</li>
            <li>Restrict execution from common drop locations (Downloads, Desktop) via AppLocker or WDAC.</li>
            <li>Baseline and monitor critical autorun locations (Run keys, services, scheduled tasks).</li>
        </ul>
    </div>

    <p style="margin-top:30px;font-size:11px;color:#64748b;text-align:right;">
        Report generated as part of TryHackMe Advent of Cyber 2025 – Day 6: Malware Analysis – Egg-xecutable.
    </p>
</div>
</body>
</html>
